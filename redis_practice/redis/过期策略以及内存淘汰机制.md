## 19.redis的过期策略以及内存淘汰机制
>缓存是指在第一次获取到数据时，把它暂存在内存中。下次需要这个数据时，就直接从内存中取，不用再去查询数据库或调用远程接口，这样可以极大地提高应用程序的性能。                  
 如果缓存中的数据永久存在，那占用的内存就会变得越来越大。而内存是有限的，所以缓存系统需要在需要的时候删除一些不必要的缓存数据以节约内存空间。                 
 Redis提供了过期策略和内存淘汰这两种机制配合来达到删除一些不必要的缓存数据以节约内存空间目的。                  
>               
>Redis是使用定期删除+惰性删除两者配合的过期策略。                
 定期删除是指Redis默认每隔100ms就随机抽取一些设置了过期时间的key，检测这些key是否过期，如果过期了就将其删掉。                     
 因为key太多，如果全盘扫描所有的key会非常耗性能，所以是随机抽取一些key来删除。这样就有可能删除不完，需要惰性删除配合。                    
 惰性删除不再是Redis去主动删除，而是在客户端要获取某个key的时候，Redis会先去检测一下这个key是否已经过期，如果没有过期则返回给客户端，
>如果已经过期了，那么Redis会删除这个key，不会返回给客户端。              
 所以惰性删除可以解决一些过期了，但没被定期删除随机抽取到的key。但有些过期的key既没有被随机抽取，也没有被客户端访问，就会一直保留在数据库，
>占用内存，长期下去可能会导致内存耗尽。所以Redis提供了内存淘汰机制来解决这个问题。                            
>                               
>为什么不使用定时删除？                            
 所谓定时删除，指的是用一个定时器来负责监视key，当这个key过期就自动删除，虽然内存及时释放，但是十分消耗CPU资源，因此一般不推荐采用这一策略。                         
>                               
>内存淘汰机制                             
 Redis在使用内存达到某个阈值时（通过maxmemory配置)，就会触发内存淘汰机制，选取一些key来删除。                        
># maxmemory <bytes> 配置内存阈值                             
># maxmemory-policy allkeys-lru                                         
>内存淘汰策略:                    
 noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。默认策略                    
 allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key。                             
 allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。                                     
 volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。                            
 volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。                        
 volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除。                                 
>                           
>如何选取合适的策略？                                 
 比较推荐的是两种lru策略。根据自己的业务需求。如果你使用Redis只是作为缓存，不作为DB持久化，那推荐选择allkeys-lru；
>如果你使用Redis同时用于缓存和数据持久化，那推荐选择volatile-lru。                              
 如果没有设置expire的key, 不满足先决条件(prerequisites); 那么 volatile-lru, volatile-random 和 volatile-ttl 策略的行为, 和 noeviction(不删除) 基本上一致。                      
