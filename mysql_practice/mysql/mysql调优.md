### 20.mysql调优
>mysql调优对于开发者而言主要是从数据库索引和解决线上慢查询方面入手。               
 mysql内部的参数调优是由专业的DBA来做的。                   
 (1).是否能使用索引覆盖，减少回表查询所消耗的时间。在select的时候一定要指明对应的列，而不是select *                 
 (2).考虑是否组建联合索引，如果组建了联合索引，尽量将区分度最高的放在最左边，并且要考虑最左前缀匹配原则                  
 (3).对索引进行函数操作或者表达式计算回导致索引失效                
 (4).利用子查询优化超多分页场景。例如limit offset , n。mysql并不是跳过offset行，而是取offset+n行，然后放弃前offset行，返回n行，那当offset特别大的时候，效率就非常的低下。         
 而利用子查询则是查出n条，通过ID检索对应的记录出来，提高查询效率。SELECT a.* FROM table1 a, (select id from table1 where 条件 LIMIT 100000,20 ) b where a.id=b.id                
 (5).通过explain命令查看sql的执行计划，看看自己写的sql是否走了索引，走了什么索引。通过show profile查看sql对系统资源的损耗情况(一般很少使用)。               
 (6).在开启事务后，在事务内尽量只操作数据库，并有意识得减少锁的持有时间。如果事务内需要插入和修改数据，那最好是先插入后修改。
>因为修改是更新操作，会加行锁。如果先更新的话，并发下可能会导致多个事务的请求等待行锁。                
 (7).如果sql走了索引后，查询还是很慢，一般来说就是表的数量量太大了。这时可以考虑删除用不到的旧数据来减少数据量，一般没有团队会这么做，是不会删除的，会把旧的数据同步到hive中。               
 或者在查询数据库之前走一层redis缓存，这时存在redis和mysql数据非真正实时的问题。            
 如果存在字符串检索的场景导致查询低效，可以考虑把表的数据导入到es搜索引擎中，后续线上查询直接走es。mysql数据导入es需要有对应的同步程序，
>一般是监听msyql的binlog(记录了数据库表结构和表数据的变更)，解析binlog后导入到es。               
 还可以考虑根据查询条件的维度，做相应的聚合表，线上的查询请求去查询聚合表的数据，而不是查询原表。例如订单明细表的数据量级非常大，
>产品侧的查询功能是以天维度来展示的，就可以将每个用户的每天数据聚合起来，聚合表就是一个用户一天只有一条汇总后的数据。是一种以空间换时间的思路。                        
 (8).当读写性能均遇到瓶颈时，先考虑能否升级数据库架构解决问题。实现数据库读写分离的架构，主库接收写请求，从库接收读请求。
>从库的数据由主库发送的binlog更新，主从的数据通过异步来保证最终的一致性。          
 (9).如果在主从架构下，读写仍然存在瓶颈，则需要考虑分库分表。                                                                                              
